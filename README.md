# Authoritative articles

1. Using your favorite DB client, design and create a table called `authors` that would store the first name, the last name, and the sex of each of the following authors:
    
      - Abi Maxwell (F)
      - Anthony Alofsin (M)
      - Emily Temple (F)
      - Gabrielle Bellot (F)
      - Meg Donohue (F)
      - Philip Eil (M)
      - Roxana Robinson (F)
      - Tobias Carroll (M)
      - Veronica Esposito (F)
     
    Don’t forget that each table must have an ID field. Please also create the necessary constraints, keys and/or indices for the table. In order to do this you might first need to read this document through the end.
     
    Copy and paste the SQL query generated by the client below:
    
    ```postgresql
   create table author
   (
   	id int,
   	first_name text,
   	last_name text,
   	sex text
   );
    ```

2. **Manually** create a query or a series of queries filling the table with the data. Put the query/queries below:

    ```postgresql
    INSERT INTO author (id, first_name, last_name, sex)
                VALUES (1, 'Abi', 'Maxwell', 'F'),
                       (2, 'Anthony', 'Alofsin', 'M'),
                       (3, 'Emily', 'Temple', 'F'),
                       (4, 'Gabrielle', 'Bellot', 'F'),
                       (5, 'Meg', 'Donohue', 'F'),
                       (6, 'Philip', 'Eil', 'M'),
                       (7, 'Roxana', 'Robinson', 'F'),
                       (8, 'Tobias', 'Carroll', 'M');
    ```

3. Using the client, design and create a table called `articles` that would store the information from the file [articles.xlsx](articles.xlsx). Use the already created `authors` table in order to refer to the authors. Don’t forget to create an ID field and all necessary constraints/keys/indices.

    Copy and paste the SQL query generated by the client below:

    ```postgresql
   create table article
   (
   	title text,
   	author_id int,
   	date date,
   	rating float(2),
   	text text
   );
    ```

4. **Using the client**, fill the table:

    ```postgresql
   INSERT INTO article (title, author_id, date, rating, text) 
   VALUES ('How Alison Bechdel Understands Her Life as Fiction', 4, '2017-10-04', 4.3, '<p>A third of the ...'),
          ('How Jamaica Kincaid Helped Me Understand My Mother', 4, '2019-03-22', 3.35, '<p>For two decades...</p>'),
          ('How Many Copies Did Famous Books Sell in the First Year?', 3, '2019-06-25', 2.4, '<p>Book publishing can ...</p>'),
          ('My Decade-Long Fascination with the Tale of Monica Lewinsky', 4, '2019-05-29', 5, '<p>For over a decade ...</p>'),
          ('On “Good Men” and the Vague, Low Standards Required to Be One', 1, '2018-04-29', 4.5, '<p>The first time I ...</p>'),
          ('On Frank Lloyd Wright and the Architectural War For New York’s Skyline', 2, '2019-02-01', 3.85, '<p>The New ...”</p>'),
          ('On the Modern American Obsession with French Revolution Narratives', 8, '2019-05-03', 4, '<p>Will we ever run ....</p>'),
          ('On Walt Whitman, Unsung Newspaperman', 6, '2018-09-15', 4.25, '<p>There are ...</p>'),
          ('The 12 Best Book Covers of June', null, '2019-06-27', 3.75, '<p>Another month ...</p>'),
          ('The Grand Cultural Influence of Octavia Butler', 3, '2019-06-21', 3.8, '<p>Tomorrow, June 22, ...</p>'),
          ('What Gets Lost (and Found) in Translating Prose to Comics', 8, '2019-01-08', 4.6, '<p>As goes language, ...</p>'),
          ('Why We’ll Never Get Tired of Literary Retellings', 5, '2019-05-28', 4.95, '<p>I make an effort to r....</p>');
 ```

5. Retrieve articles with the information about the author attached to each row (there should be 12 rows in the result and around 10 columns, including the article’s title, text, rating, and date as well as the author’s name and sex):

    ```postgresql
   SELECT * FROM article INNER JOIN author ON article.author_id = author.id;
    ```

6. To get the twelve rows, you must have used one of the constructions `INNER JOIN`, `LEFT JOIN`, `RIGHT JOIN`, or `FULL JOIN`. How many rows would the other three have returned? First try to think of the answers and then verify them by running the queries (it’s important you understand the results). Put the numbers below:

    ```
    INNER JOIN: 11 rows
    LEFT JOIN: 12 rows
    RIGHT JOIN: 13 rows
    FULL JOIN: 14 rows
    ```

7. Imagine you’re using pagination to display articles showing five articles per page. Retrieve the content for the first page: create a query that would return the latest five articles, ordered from the latest to the earliest.

    ```postgresql
    SELECT * FROM  article ORDER BY DATE DESC LIMIT 5;
    ```

8. Retrieve the content for the second page: articles 6 through 10 (still assuming chronological order).

    ```postgresql
   SELECT * FROM  article ORDER BY DATE DESC LIMIT 5 OFFSET 5;
    ```
    
9. Retrieve the content for the third page: articles 11 through 15 (never mind there are actually only 12 of them currently in the table).

    ```postgresql
   SELECT * FROM  article ORDER BY DATE DESC LIMIT 5 OFFSET 10;
    ```
    
10. Count the number of five-article pages required to accommodate all articles:

    ```postgresql
    SELECT ceil(count(*)/5.0) AS count  FROM  article;
    ```
    
11. Calculate an average rating of the articles, rounded to the nearest integer:

    ```postgresql
    SELECT round(avg(rating)) FROM  article;
    ```

12. Count males and females among the authors. There should be two rows (for males and females) and two columns: `sex` (`F` or `M`) and `cnt` (count).

    ```postgresql
    SELECT count('F') AS "cnt",sex FROM  author GROUP BY sex;
    ```

13. Find the date of the earliest (put in the column `earliest`) and latest (put in the column `latest`) article written by each author:

    ```postgresql
    SELECT author.first_name ||' '|| author.last_name,
    min(article.date) AS "earliest",
    max(article.date) AS "latest"
    FROM author INNER JOIN article ON article.author_id = author.id
    GROUP BY author.first_name ||' '|| author.last_name;
    ```
    
14. Calculate the total length of the text written by each author (count both `text` and `title`; you can keep the tags in `text` while counting):

    ```postgresql
    SELECT author.first_name ||' '|| author.last_name, sum(length(title) + length(text))
    FROM article LEFT JOIN author ON article.author_id = author.id
    GROUP BY author_id, author.first_name, author.last_name;
    ```
    
15. Output all the authors in a random order. There should be only one column aliased `author` with the first and last name of the author concatenated (using a space, of course). The order of the rows should be different on each request:

    ```postgresql
    SELECT first_name ||' '|| last_name AS "author"
    FROM author ORDER BY random();
    ```

16. "Anonymize" the authors: replace each author’s last name with the properly capitalized reverse of it. E.g., `Alofsin` should become `Nisfola`, `Esposito` should become `Otisopse`, etc.

    ```postgresql
    SELECT first_name, initcap(reverse(last_name)) FROM author;
    ```
    
17. Delete all articles that don’t have an author:

    ```postgresql
    DELETE FROM article WHERE author_id IS NULL;
    ```

18. **(optional)** Delete all authors that haven’t written any articles:

    ```postgresql
    DELETE FROM author WHERE id NOT IN (SELECT author_id FROM article);
    ```

Don’t forget to create a pull request.
